<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Fast Robots - Patty Meza</title>
        <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:500,700" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,800,800i" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
            <a class="navbar-brand js-scroll-trigger" href="#page-top">
                <span class="d-block d-lg-none">Patty Meza</span>
                <span class="d-none d-lg-block"><img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="images/me.png" alt="..." /></span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#about">Home</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#lab1">Lab 1</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#lab1.2">Lab 1.2</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#lab2">Lab 2</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#lab3">Lab 3</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#lab4">Lab 4</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#lab5">Lab 5</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#lab6">Lab 6</a></li>
                </ul>
            </div>
        </nav>
        <!-- Page Content-->
        <div class="container-fluid p-0">
            <!-- About-->
            <section class="resume-section" id="about">
                <div class="resume-section-content">
                    <h1 class="mb-0">
                        Patty <span class="text-primary">Meza</span>
                    </h1>
                    <div class="subheading mb-5">
                        <a href="mailto:name@email.com">pim9@cornell.edu</a>
                    </div>
                    <p class="lead mb-5">Hi! This is my home page for my ECE 4160 labs. I am a Senior MechE student at Cornell University and I am interested 
                        in robotics for extreme environments such as space! I am currently building a 
                        bipedal robot for my project team Cornell Cup Robotics!</p>

                </div>
            </section>
            <hr class="m-0" />
            
            
<!------------------------------------- LAB 1 ----------------------------------->
<!------------------------------------- LAB 1 ----------------------------------->
<!------------------------------------- LAB 1 ----------------------------------->
            
            <section class="resume-section" id="lab1">
                <div class="resume-section-content">
                    <h2 class="mb-5">Lab 1</h2>
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Introduction</h3>
                            <div class="subheading mb-3">Lab Objectives</div>
                            <p>The objective of this lab is to set up and become familiar with the Arduino IDE and the Artemis board. We set up the board and downloaded 
                                the necessary packages to facilitate sending messages from the board to our computer over Bluetooth. Using the Arduino examples, we the 
                                practiced reading/writing serial messages over USB.</p>
                            <div class="subheading mb-3">Components</div>
                            <p>1 x SparkFun RedBoard Artemis Nano</p>
                            <p>1 x USB C-to-C or A-to-C cable</p>
                        </div>
                        <div class="flex-shrink-0"><span class="text-primary">Janurary 24th</span></div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            
                            <h3 class="mb-0">Prelab</h3>
                            <div class="subheading mb-3">Artemis Board Set up</div>
                            <div style="margin-bottom: 40px;">
                                <p>I started with downloading the Arduino IDE and setting up the SparkFun RedBoard Artemis Nano with these 
                                    <a href="https://learn.sparkfun.com/tutorials/artemis-development-with-arduino?_ga=2.30055167.1151850962.1594648676-1889762036.1574524297&_gac=1.19903818.1593457111.Cj0KCQjwoub3BRC6ARIsABGhnyahkG7hU2v-0bSiAeprvZ7c9v0XEKYdVHIIi_-J-m5YLdDBMc2P_goaAtA4EALw_wcB">
                                        instructions</a></p>
                                <p>I plugged the board into my computer and I ensured the Arduino IDE was able to locate it and selected the appropriate port (see the below screenshot)</p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab1/port.png" alt="..." /></span>
                            </div>
                            
                            <div class="subheading mb-3">Tasks</div>
                            <div style="margin-top: 10px;">
                                <p>1. I tried various example codes provided by the Apollo dev kit starting with "Blink" In File->Examples->Basics, here is a video of what happened once I uploaded the code to the board.</p>
                                <iframe width="560" height="315" src="https://www.youtube.com/embed/lbY7I_NVAPI?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <p>2. Next, I tried "Example4_Serial" In File->Examples->Artemis Examples, here is what printed out in the serial monitor once I uploaded the code onto the board.</p>
                                <div><span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab1/serial_crop.png" alt="..." /></span></div>
                            </div>

                            <div style="margin-top: 20px;">
                                <p>3. The next task was to test the temperature sensor with "Example2_analogRead" File->Examples->Artemis Examples. In this video, you can see the temperature values increasing when I hold my finger over the sensor.</p>
                                <iframe width="560" height="315" src="https://www.youtube.com/embed/Nesj9T_TWc0?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                            </div>

                            <div style="margin-top: 20px;">
                                <p>4. Lastly, I tested the microphone with the sample code "Example1_MicrophoneOutput" in File->Examples->PDM. In this video, I play a constant note and in the serial monitor, you can see the frequency change and hold constant.</p>
                                <iframe width="560" height="315" src="https://www.youtube.com/embed/3NaEEql777o?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Setting up Bluetooth connection</h3>
                            <div class="subheading mb-3">Computer set up</div>

                            <div>
                                <p>I first started by verifying what version of Python and Pip I had using the macOS terminal.
                                I confirmed I had the latest releases (Python >= 3.9 and pip >= 21.0)</p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab1/checkvers.png" alt="..." /></span>
                            </div>

                            <div style="margin-top: 30px;">
                                <p>Then I installed the virtual environment using the following commands:
                                    <br><span class="text-primary">python3 -m pip install --user virtualenv</span>
                                    <br><span class="text-primary">cd /Users/patty/Documents/fastrobots</span>
                                    <br><span class="text-primary">python3 -m venv FastRobots_ble</span>
                                </p>
                                
                                <p>To start the virtual environment use this command:
                                    <br><span class="text-primary">source FastRobots_ble/bin/activate</span>
                                </p>
                                
                                <p>To confirm you are in the virtual environment you should see the prefix (FastRobots_ble) before each command:</p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab1/prefix .png" alt="..." /></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <div style="margin-top: 20px;" class="subheading mb-3">Artemis Board Setup</div>
                            
                            <div style="margin-top: 20px;">
                                    <p>Install ArduinoBLE from the library manager (Tools -> Manage Libraries…) in the Arduino IDE.</p>
                                    <p>Open and run ble_arduino.ino into the Artemis board from the directory ble_arduino in the codebase.</p>
                                    <p>The Artemis board should now print its MAC address.<br> My MAC address: C0:83:0C:69:AC:3C </p>
                                    <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab1/mac adress.png" alt="..." /></span>
                                </div>

                                <div style="margin-top: 20px;">
                                    <p>I downloaded the provided codebase into my project directory. I copied the "ble_python" directory into my project directory. 
                                        And finally, I started the Jupyter server by typing in the command:
                                        <br><span class="text-primary">Jupyter lab</span>
                                    </p>
                                </div>
                            
                            </div>
                        </div>
                    </div>
  
                </div>
            </section>
            <hr class="m-0" />
        
<!------------------------------------- LAB 1.2 -------------------------------------->            
<!------------------------------------- LAB 1.2 -------------------------------------->
<!------------------------------------- LAB 1.2 -------------------------------------->
        
            <section class="resume-section" id="lab1.2">
                <div class="resume-section-content">
                    <h2 class="mb-5">LAB 1.2</h2>
                    
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Introduction</h3>
                            <div class="subheading mb-3">Lab Objectives</div>
                            <p>The objective of this lab is to continue from lab 1 and test the Bluetooth connection between 
                                the board and our laptops. We practiced sending timestamped messages from the Artemis board, and 
                                how to use notification handlers in Jupyter Notebook to receive and handle these messages.</p>
                            <div class="subheading mb-3">Components</div>
                            <p>1 x SparkFun RedBoard Artemis Nano</p>
                            <p>1 x USB C-to-C or A-to-C cable</p>
                        </div>
                        <div class="flex-shrink-0"><span class="text-primary">Janurary 29th</span></div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Set up</h3>
                            <div class="subheading mb-3">How to log back into virtual machine</div>
                            
                            <div style="margin-top: 20px;">
                                <p> Open the terminal and type these 3 commands one at a time. This navigates to the correct directory, 
                                    opens the virtual machine, and starts the Jupyter Notebook tab on my browser.
                                    <br><span class="text-primary">cd /Users/patty/Documents/fastrobots</span>
                                    <br><span class="text-primary">source FastRobots_ble/bin/activate</span>
                                    <br><span class="text-primary">Jupyter lab</span>
                                </p>
                            </div>

                            <div class="subheading mb-3">Configurations</div>
                            <div style="margin-top: 20px;">
                                <p> I made a copy of the ble_arduino.ino file, and the demo.ipynb file and did the rest of the lab tasks there.</p>
                                <p> I added added MAC address here in the connection.yaml file from the project directory.</p>
                                    <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab2/adressloc.png" alt="..." /></span>
                            </div>

                            <div style="margin-top: 30px;">
                                <p> What is a UUID? It stands for Universally Unique Identifiers and they help differentiate the 
                                    different kinds of data that we are sending.
                                    Run these two lines in a code block in Jupyter Notebook to generate a new UUID.
                                    <br><span class="text-primary">from uuid import uuid4</span>
                                    <br><span class="text-primary">uuid4()</span>
                                </p>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <p> With a newly generated UUID, copy and paste it into these two locations. In the connection.yaml file and in the
                                    ble_arduino.ino file. Make sure the UUIDs used in the Arduino sketch always match those used by Python in the configuration 
                                    file (connection.yaml).
                                    <!------- IMAGES side by side HERE --------->
                                <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 75px; width: auto;" src="images/lab2/uuid1.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 75px; width: auto;" src="images/lab2/uuid2.png" alt="Image 2" /></div>
                                </div>
                                </p>
                            </div>
                            
                        </div>
                    </div>


                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Practice!</h3>
                            <div class="subheading mb-3">Tasks to practice receiving messages from the Artemis board</div>

                            <div style="margin-top: 20px;">
                                <p>I am connected to Bluetooth!</p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab2/blut.png" alt="..." /></span>
                            </div>
                            
                            <div style="margin-top: 70px;">
                                <p> 1. Send an ECHO command with a string value from the computer to the Artemis board, 
                                    and receive an augmented string on the computer.</p>
                                <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 90px; width: auto;" src="images/lab2/task1.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 250px; width: auto;" src="images/lab2/echo.png" alt="Image 2" /></div>
                                </div>
                                <p style="margin-top: 10px;" style="padding-right: 10px;" class="text-dark"> In my Python script, I am using the send_command() function which
                                    sends a string data to the GATT characteristic (TX_CMD_STRING). Then there is a case called "ECHO" in my Arduino script that received the message
                                    and manipulates the string. I have it print to the Arduino serial (for testing purposes) and then I have it send the edited string back with the writeValue() function. 
                                    since I have a receive_string() function, it reads the most recent string message and prints it out to the Python script. </p>
                            </div>

                            <div style="margin-top: 70px;">
                                <p> 2. Add a command GET_TIME_MILLIS which makes the robot reply write a string such as “T:123456” to the string characteristic.</p>
                                <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 90px; width: auto;" src="images/lab2/task2.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 150px; width: auto;" src="images/lab2/get time millis.png" alt="Image 2" /></div>
                                </div>
                                <p style="margin-top: 10px;" style="padding-right: 10px;" class="text-dark"> This command is similar to the case before, except I sent the Arduino an empty message since it just 
                                    wanted to trigger code in the GET_TIME_MILLIS case in Arduino. Once that case was called, it used the millis() function to generate a time in milliseconds. It is important to clear the string,
                                    then append the parts I need every time becuase I was sending multiple different messages between the two. Again, I have a receive_string() function in my python that reads the string and 
                                    prints it out.</p>
                            </div>

                            <div style="margin-top: 70px;">
                                <p> 3. Set up a notification handler in Python to receive the string value from the Artemis board. 
                                    In the callback function, extract the time from the string.</p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab2/task3.png" alt="..." /></span>
                                <p style="margin-top: 10px;" style="padding-right: 10px;" class="text-dark"> In my notification handler I look for the "t" character in the string. Then I have an if statement basically so it 
                                    only continues if it can find that t. Then it manipulates the string to only have the time as a float, then I store it in an array called time_msg. The start_notify funciton activated the notification hanlder.
                                    so it is constantly running and will automatically read the messages sent from the Arduino of the proper type. 
                            
                            <div style="margin-top: 70px;">
                                <p> 4. Write a loop that gets the current time in milliseconds and sends it to your laptop to be received and processed 
                                    by the notification handler. Collect these values for a few seconds and use the time stamps to determine how fast messages 
                                    can be sent. What is the effective data transfer rate of this method?</p>
                                    <!------- IMAGES side by side HERE --------->
                                <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 200px; width: auto;" src="images/lab2/task4.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 200px; width: auto;" src="images/lab2/timetest.png" alt="Image 2" /></div>
                                </div>
                                <p style="margin-top: 10px;" style="padding-right: 10px;" class="text-dark"> In python I sent the command TIME_TEST, wich corresponds to the case in the ardino code. this is a loop that runs a set number of times
                                    (in this case 1000) and it reads the current time in milliseconds and sends it as a string. now that my notification handler is running, it knows how to edit this string, every time this
                                    loop runs. I have a second block of code that is to find the data transfer rate. Once the loop is finished running, it uses the first and last time values to find the total rate of message transfer. 
                                    in this case, the time was 133.6005 messages sent per second.  </p>
                            </div>

                            <div style="margin-top: 70px;">
                                <p> 5. Now create an array that can store time stamps. This array should be defined globally so that other functions can access it if need be. 
                                    In the loop, rather than send each time stamp, place each time stamp into the array.
                                    Then add a command SEND_TIME_DATA which loops the array and sends each data point as a string to your laptop to be processed. (You can store these values in a list in python to determine if all 
                                    the data was sent over.)</p>
                                <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 220px; width: auto;" src="images/lab2/task5.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 300px; width: auto;" src="images/lab2/send time data.png" alt="Image 2" /></div>
                                </div>
                                <p style="margin-top: 10px;" style="padding-right: 10px;" class="text-dark"> For this problem I made two        separate cases to send commands to in the Arduino script. The first one FILL_TIME_ARRAY is to only 
                                    fill up an array with the times. The second case SEND_TIME_DATA, loops over the array and sends it all at once. I made another code block to test how many messages were sent per second and 
                                    with this method, 403.88 messages were sent per second. </p>
                            </div>

                            <div style="margin-top: 70px;">
                                <p> 6. Add a second array that is the same size as the time stamp array. Use this array to store temperature readings. Each element in both 
                                    arrays should correspond, e.e., the first time stamp was recorded at the same time as the first temperature reading. Then add a command GET_TEMP_READINGS 
                                    that loops through both arrays concurrently and sends each temperature reading with a time stamp. The notification handler should parse these strings and 
                                    and populate the data into two lists.</p>
                                <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 300px; width: auto;" src="images/lab2/task6.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 300px; width: auto;" src="images/lab2/sendtemp.png" alt="Image 2" /></div>
                                </div>
                                <p style="margin-top: 10px;" style="padding-right: 10px;" class="text-dark"> This one took a bit more problem solving so I made a separate notification handler for these types of messages. In the Python, I sent two separate commands to fill the arrays with data and 
                                    then to send it all at once because we proved earlier this was the faster way of sending data. FILL_TEMP_ARRAY filled both an array with temperatures and timestamps that coorespond to each. Then GET_TEMP_READINGS creates a string with an upper case T: for temperature and 
                                    a lower case t: for time from the timestamp array. Once all the data is appended to a string it is sent. this loops over the whole array of collected temperatures. In the notification handler, I look for the time and the temperature and extract them from the string.
                                    Last, I printed them all out in nice columns. </p>
                            </div>

                            <div style="margin-top: 70px;">
                                <p> 7. Discuss the differences between these two methods, the advantages and disadvantages of both and the potential scenarios 
                                    that you might choose one method over the other. How “quickly” can the second method record data? The Artemis board has 384 kB of RAM. Approximately how much data can you store to send without running out of memory?</p>
                                <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 180px; width: auto;" src="images/lab2/meth1.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 180px; width: auto;" src="images/lab2/meth2.png" alt="Image 2" /></div>
                                </div>
                                <p style="margin-top: 10px;" style="padding-right: 10px;" class="text-dark"> I calculated the time to send messages for both scenarios previosly in my script. The first method sent approximately 133 messages per second and 
                                    the second method was able to send approximately 404 messages per second. Then using our knowledge of the RAM capacity of the Artemis, I calculated that with method 1 I can send messages for over 5 minutes before I run out of storage
                                    and with the second method I can send messages for 1.8 minutes before I run out of storage. The advantages of the first method is that we can send real-time transmission of data, as time stamps are sent immediately after being generated.
                                    Disadvantages could be the slower rate of data transfer and higher potential for data loss or delays if the communication channel experiences congestion or interference. The second method, other than the speed, has the advantage of providing more flexibility in handling and processing data 
                                    on both the sender and receiver sides. A disadvantage could be having to wait till the array is filled to send the data, and having to make sure the array is not over-filled. 
                                    In the callback function, extract the time from the string. </p>
                            </div>

                            
                        </div>
                    </div>

                    
                </div>
            </section>
            
<!------------------------------------- LAB 2 ---------------------------------------------->           
<!------------------------------------- LAB 2 ---------------------------------------------->
<!------------------------------------- LAB 2 ---------------------------------------------->
        
            <hr class="m-0" />
            <section class="resume-section" id="lab2">
                <div class="resume-section-content">
                    <h2 class="mb-5">Lab 2</h2>

                    
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <!---------------------------INTRO------------------------------->
                            <h3 class="mb-0">Introduction</h3>
                            <div class="subheading mb-3">Lab Objectives</div>
                            <p>The objective of this lab is to add the IMU to the robot and to learn how to use readings from the accelerometer
                            and gyroscope. I learned how to filter data to get the most accurate reading. We also got to test out our stunt cars!</p>
                            <div class="subheading mb-3">Components</div>
                            <p>1 x SparkFun RedBoard Artemis Nano</p>
                            <p>1 x USB C-to-C or A-to-C cable</p>
                            <p>1 x 9DOF IMU sensor</p>
                            <p>1 x Force1 RC car</p>
                            <p>1 x Li-Ion 3.7V 850mAh battery</p>
                        </div>
                        <div class="flex-shrink-0"><span class="text-primary">Februrary 7th</span></div>
                    </div>
                        
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <!---------------------------Set up the IMU ------------------------------->
                            <h3 class="mb-0">Set up the IMU</h3>
                            
                            <div style="margin-top: 20px;">
                                <p> 1. In the Arduino library manager, install the SparkFun 9DOF IMU Breakout - ICM 20948 - Arduino Library</p>
                                <p> 2. Connect the IMU to the artemis</p>
                                    <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab2.0/imu.jpg" alt="..." /></span>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> 3. Run the file “..\Arduino\libraries\SparkFun_ICM-20948\SparkFun_ICM-20948_ArduinoLibrary-master\examples\Arduino\Example1_Basics”</p>
                                <p> 4. Look for the variable <span class="text-dark">AD0_VAL</span>, set it to zero. 
                                <br> (This variable represents the last bit of the i2c address of the IMU. It needs to be set to 0 or 1 depending on if the ADR jumper is closed)</p>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> I added a blinking light during startup as a visual indication that the board is running. Then I tested the accelerometer data with the serial plotter, 
                                you can see as I flip the IMU in different ways how the lines fluctuate. The data is pretty noisy. </p>
                                <iframe width="560" height="315" src="https://www.youtube.com/embed/vMpoU66qJ04?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                            </div>
                            
                            <!---------------------------ACCELEROMETER------------------------------->
                            <h3 style="margin-top: 60px;" class="mb-0">Accelerometer</h3>
                            <div class="subheading mb-3">Convert Accelerometer Data into Pitch and Roll</div>
                            <div style="margin-top: 20px;">
                                <p> These are the equations I used to convert the raw accelerometer data into Euler angles (pitch and roll).</p>
                                 <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 60px; width: auto;" src="images/lab2.0/pitcheqn.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 60px; width: auto;" src="images/lab2.0/rolleqn.png" alt="Image 2" /></div>
                                </div>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> Here is a video of me holding the IMU steady with a pitch of -90 degrees and a roll of zero. I am printing the values in degrees to the serial monitor 
                                of the Arduino. As you can see the accelerometer is pretty accurate so there is no need for a two-point calibration. </p>
                                <iframe width="560" height="315" src="https://www.youtube.com/embed/fDkZO7NKR94?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                            </div>

                            <div style="margin-top: 30px;" class="subheading mb-3">Analyzing The Frequency Spectrum</div>
                            <div style="margin-top: 5px;">
                                <p> Because there is noise, it is good to analyze the data in the frequency spectrum, to see what frequencies of noise are prevalent
                                    .I recorded accelerometer data on the Artemis and sent it over to my computer. I downloaded Scipy.fftpack package to graph the FFT. 
                                    Below is how I calculated the Fourier transform. 
                                </p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab2.0/fourier calc.png" alt="..." /></span>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> Below are my Fourier spectrum graphs for both pitch and roll when the IMU is flat on the table. The left is the raw data measurement and the right is the FFT. </p>
                                <span class="d-none d-lg-block"><img style="width: 700px; height: auto;" src="images/lab2.0/still fourier.png" alt="..." /></span>
                                <p> I then tried adding a vibration by hitting the table. You can see in the amplitude graph where I hit the table, but the FFT graph still looks similar with larger magnitudes.</p>
                                <span class="d-none d-lg-block"><img style="width: 700px; height: auto;" src="images/lab2.0/hitfourier.png" alt="..." /></span>
                                <p> None of the frequencies stood out to me in the vibration test but the parts of the spectrum with the highest spikes occur at around 10 Hz and 35 Hz, I could not determine an 
                                obvious cutoff frequency but I kept playing around with it and decided to start with a cutoff frequency of 10 Hz.</p>
                            </div>

                            <div class="subheading mb-3">Applying Low Pass Filter</div>
                            
                            <div style="margin-top: 20px;">
                                <p> For the low-pass filter, to calculate my alpha value I used these formulas starting with the cutoff frequency (fc), and period (T) which is 1/sampling rate.</p>
                                <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 60px; width: auto;" src="images/lab2.0/fceqn.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 60px; width: auto;" src="images/lab2.0/alphaeqn.png" alt="Image 2" /></div>
                                </div>
                                
                                <p style="margin-top: 20px;"> After yielding an alpha value of ~ 0.12, I used this formula for both pitch and roll to filter my raw accelerometer data. </p>
                                <span class="d-none d-lg-block"><img style="width: 500px; height: auto;" src="images/lab2.0/lpfeqn.png" alt="..." /></span>

                                <p style="margin-top: 20px;"> Here is what my LPF looks like in the Arduino code.
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab2.0/lpf code.png" alt="..." /></span></p>

                                <p style="margin-top: 10px;"> This is a graph of the raw data and filtered data taken at the same time. This one is with the 10 Hz cutoff frequency. As you can see it is better but there is still 
                                a significant amount of noise. 
                                <span class="d-none d-lg-block"><img style="width: 700px; height: auto;" src="images/lab2.0/f=10.png" alt="..." /></span></p>
                                
                                <p> I tried filtering again but with a lower cutoff frequency of 4 Hz and I hit the table at the begining. This was significantly better at minimizing the noise. 
                                <span class="d-none d-lg-block"><img style="width: 700px; height: auto;" src="images/lab2.0/f=4.png" alt="..." /></span></p>
                                
                                <p> I think my low pass filter overall worked great. The values it outputs for the angles are consistent. There is still a good amount of noise but 
                                    I cannot keep lowering the frequency cutoff value or else I will miss out on important signals from the sensors.</p>
                            </div>
                            <!---------------------------GYROSCOPE------------------------------->
                            <h3 class="mb-0">Gyroscope</h3>
                            <div class="subheading mb-3">Compute Pitch, Roll, and Yaw Angles</div>
                            <div style="margin-top: 20px;">
                                <p> To convert the raw gyroscope data to Roll, Pitch, and Yaw angles, I multiplied the angle by a time increment dt and added it to the current angle.
                                    Here is the code in my arduino. 
                                    <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab2.0/gyrocode.png" alt="..." /></span>
                                </p>

                                <p> This is a graph of gyroscope roll, pitch, and yaw vs time. I rotated the IMU back and forth as you can see from the occilations. The issue with the gyroscope is that it constantly "drifts". 
                                    As you can see the angels apear to be driting and increasing slowly even if i was retunring teh gyrosope to the same place each time. 
                                    <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab2.0/drifting gyro.png" alt="..." /></span>
                                </p>
                                <p> The main differnce between the gyroscope data and the accelerometer data is that the gyrosope drifts from the start. Becuase the gyrposcope only measures relative angles, I need to always 
                                    initiallize the first position as zero. And lastly, the gyroscope has much less noise than the accleerometer data which is a big benifit. I tried playing around with the sampling rate 
                                    by adding in delays, I found that the longer the delay (lower sampling rate), the more the gyroscope values drift. Below is the data with keeping it still (my leg was tapping under the desk).
                                    <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab2.0/driftmore.png" alt="..." /></span>
                                </p>
                            </div>
                            <!---------------------------Complementary Filter------------------------------->
                            <h3 class="mb-0">Complementary Filter</h3>
                            <div class="subheading mb-3">Combining Gyroscope data and Accelerometer Data</div>
                            <div style="margin-top: 20px;">
                                <p> A complimentray filter can be uaed to combine the two types of data, gyroscope and accelerometer. It uses the most useufl parts from both and creates the most 
                                    accurate filter that is not susceptible to drift or quick vibrations. I tried various alpha values in order to determine wich filter to putthe most weight on.  
                                    The following is the equation for the complimentary filter. 
                                    <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab2.0/compfilter.png" alt="..." /></span>
                                </p>
                                <p> To implement it on the artemis, I took the accelerometer low pass filter and gyroscope readings all together and passed it though my complimentary filter. 
                                    <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab2.0/compcode.png" alt="..." /></span>
                                </p>
                                <p> I decided to go with an alpha of 0.1. After many tries it seemed to be the best combination of the two. As you can see in the image below. The complimentary filter did a good job
                                    of combineing the two filters. In these images I am just rolling it from -90 to zero to 90 and back to zero. In the roll graph, all the filters are fairly accurate so you dont see the 
                                    benefits of the complimentary filter as much, but in the pitch graph (I was trying to keep it constant) you can see how the complimentary filter kept the noise low and did not drift. 
                                    <div style="display: flex; align-items: flex-start;">
                                        <div style="margin-right: 8px;"><img style="height: 350px; width: auto;" src="images/lab2.0/comproll.png" alt="Image 1" /></div>
                                        <div style="margin-left: 8px;"><img style="height: 350px; width: auto;" src="images/lab2.0/comppitch.png" alt="Image 2" /></div>
                                    </div>
                                </p>
                                <p> In this measurement of data I added vibrations and the filter did a good job. You can see especially see in the pitch graph where the complimentary filter
                                    is not susceptible to the gyroscope drifting and is much less noisy then just the LPF filter.
                                    <div style="display: flex; align-items: flex-start;">
                                        <div style="margin-right: 8px;"><img style="height: 350px; width: auto;" src="images/lab2.0/viberoll.png" alt="Image 1" /></div>
                                        <div style="margin-left: 8px;"><img style="height: 350px; width: auto;" src="images/lab2.0/vibepitch.png" alt="Image 2" /></div>
                                    </div>
                                </p>

                            </div>
                            <!---------------------------Sample Data------------------------------->
                            <h3 class="mb-0">Sample Data</h3>
                            <div class="subheading mb-3">Improving the way I Sample Data</div>
                            <div style="margin-top: 20px;">
                                <p> After making sure all my filters were running smoothly, I implemented a few strategies to speed up the excecution of the main loop and the sampling rate. 
                                    I deleted all my comments, and removed all my delays. I also moved the part where I checked if the data is ready in the main loop (see below). I was able to record a sampling rate
                                    of about 315 messages per secodn this way this is almost double what I had before.
                                    <div style="display: flex; align-items: flex-start;">
                                        <div style="margin-right: 8px;"><img style="height: 250px; width: auto;" src="images/lab2.0/void.png" alt="Image 1" /></div>
                                        <div style="margin-left: 8px;"><img style="height: 150px; width: auto;" src="images/lab2.0/sampling rate.png" alt="Image 2" /></div>
                                    </div>
                                </p>
                            </div>
                            <!---------------------------STUNT------------------------------->
                            <h3 style="margin-top: 50px;" class="mb-0">Stunt Car!</h3>
                            <div class="subheading mb-3">Using Built-in Controller</div>
                            <div style="margin-top: 20px;">
                                <p> Here I am performing several stunds using the car's original controller. 
                                     <iframe width="560" height="315" src="https://www.youtube.com/embed/tUKXVbgNJHY?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                                </p>
                            </div>
                        
                        
                        
                        
                        </div>
                    </div>
                </div>
            </section>
        
            <hr class="m-0" />

<!------------------------------------- Lab 3 ------------------------------------->
<!------------------------------------- Lab 3 ------------------------------------->
<!------------------------------------- Lab 3 ------------------------------------->
        
            <section class="resume-section" id="lab3">
                <div class="resume-section-content">
                    <h2 class="mb-5">Lab 3</h2>

                    
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <!---------------------------INTRO------------------------------->
                            <h3 class="mb-0">Introduction</h3>
                            <div class="subheading mb-3">Lab Objectives</div>
                            <p>The objectice of this lab is to start soldering components, we soldered the lithium-ion battery to the appropriate connector so we can use the
                                artemis board without needing to be pluggin in to our laptops. We also soldered the time of flight sensors to QWIIC Breakout board conenctor. 
                                With the ToF sesors, I and learned how to read and send data with two identicle sensors. I also implemented ways to read sensor data as quick as possible. </p>
                            <div class="subheading mb-3">Components</div>
                            <p>1 x SparkFun RedBoard Artemis Nano</p>
                            <p>1 x USB cable</p>
                            <p>2 x 4m ToF sensor</p>
                            <p>1 x QWIIC Breakout board</p>
                            <p>2 x Qwiic connector</p>
                            <p>1 x Measuring tape</p>
                        </div>
                        <div class="flex-shrink-0"><span class="text-primary">Februrary 14th</span></div>
                    </div>
                        
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <!--------------------------- 1. Power up your Artemis with a battery! ------------------------------->
                            <h3 class="mb-0">Power up!</h3>
                            <div class="subheading mb-3">Power the Artemis with a battery.</div>
                            <div style="margin-top: 20px;">
                                <p> I cut the current connector off the lithium ion battery cutting the wires <strong>one at a time!</strong> (so you don't complete the circuit with the scisors and short the battery).
                                 Then I solderd the battery wires to the JST jumper wires and isulated the exposed wire with heat shrink. Below is the battery after I cut it and after I soldered the new connector on. </p>
                                <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 200px; width: auto;" src="images/lab3/cutbattery.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 200px; width: auto;" src="images/lab3/battery.png" alt="Image 2" /></div>
                                </div>
                            </div>
                            <div style="margin-top: 20px;">
                                <p> Next I powered the artemis with the battery alone (no usb into laptop). To make sure it worked still, I resetted the artemis and as you can see in the video 
                                below, the blue light blinked 3 times. I had this blink sequence occur on startup in the code that I last uploaded to the artemis. </p>
                                <iframe width="600" height="325" src="https://www.youtube.com/embed/cZVs6-4sXBw?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> Next, I installed the SparkFun VL53L1X 4m laser distance sensor library and I connected the QWIIC break-out board to the Artemis.</p>
                            </div>
                            
                            <!---------------------------4. Connect the first ToF sensor to the QWIIC breakout board ------------------------------->
                            <h3 style="margin-top: 60px;" class="mb-0">Set up ToF sensors</h3>
                            <div class="subheading mb-3">Connect the first ToF sensor to the QWIIC breakout board.</div>
                            <div style="margin-top: 20px;">
                                <p> I used the data sheet to create a plan on how I was going to solder the QWIIC cable to the first time of flight sensor. Once I decieded what goes where, I solderd it
                                directly on the boaard and used heat shrink on the ends. This was my first time soldering so I was nervous at first, I found the helping hands to be extemly helpful to not mess up.</p>
                                 <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 250px; width: auto;" src="images/lab3/diagram.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 250px; width: auto;" src="images/lab3/sensor1.png" alt="Image 2" /></div>
                                </div>
                            </div>
                            
                            <!--------------------------->
                            <div style="margin-top: 30px;" class="subheading mb-3">Scan the I2C channel and test the first sensor.</div>

                            <div style="margin-top: 20px;">
                                <p> I navigated to the example arduino code: File->Examples->Apollo3->Wire and open Example1_wire_I2C. When i ran that it printed out the adress 0x29, this is as excpeted as everyone else
                                in the class ahd thesaem adress sicne we all had identical components.</p>
                            </div>
                            <div style="margin-top: 5px;">
                                <p> Next I ran the example: \Arduino\libraries\SparkFun_VL53L1X_4m_Laser_Distance_Sensor\examples\Example1_ReadDistance. As you can see in teh video below the sensor was woking!
                                 As I got close to my screen, the numbers apporched zero. 
                                </p>
                                <iframe width="600" height="325" src="https://www.youtube.com/embed/pTOrQeRrkeQ?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                            </div>

                            <!--------------------------------- Testing different sensor modes -------------------------------->
                            <h3 style="margin-top: 60px;" class="mb-0">Testing different sensor modes</h3>
                            <div class="subheading mb-3">Pros & Cons of each mode</div>

                            <div style="margin-top: 20px;">
                                <p> I tested two modes on the sensor short and long. In the setup of the arduino script this is how I set the mode: </p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab3/set distance mode.png" alt="..." /></span>
                                <p style="margin-top: 20px;"> The short mode is best up to distances of 1.3m away but the default mode is long, which is most accurate at distances 1.3-4m away. Choosing wich mode to use is 
                                dependant on the use of the robot. If you are naviagitng through tight obstacles that you might be running into a lot, the short mode is best so that you can react quickly. If you are trying to path plan
                                in a larger winding hallway the long range might be better so you can more acurately predict the turns it will take. </p>
                                <p> Below is an image of the test setup I did so I could test both modes at various distances. I set up a measuring tape and marked the specifc distances I wanted to test. I held the TOF sensor on a flat surface and
                                taped it down so it would always be in the exact same place. I moved a white cardboard box to the position and ran the sensor for 100 measurements, and repeated for both modes.  </p>
                                <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 280px; width: auto;" src="images/lab3/setup1.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 280px; width: auto;" src="images/lab3/setup2.png" alt="Image 2" /></div>
                                </div>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> In the python script, I received the data and saved the mean of each distance measurement in an array. I tested both modes at 5cm, 10cm, 1m, and 2m. I then graphed the results
                                with a red dotted line showing where the actual measuremtns should be. As expected, the short mode sensor was closer to the actual values in the shorter range and the long mode was closer in the longer range.
                                I was suprised buy the undershoot of over 100 millimenters in both modes at the longest range. I thought it would be more accuratre. I think next time I should try other colours to reflect off of. </p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab3/toftest.png" alt="..." /></span>
                            </div>

                            <!--------------------------- Hookup both TOF sensors ------------------------------->
                            <h3 style="margin-top: 50px;" class="mb-0">Setting up Both ToF Sensors</h3>
                            <div class="subheading mb-3">First method to record data with both sensors simultaniously.</div>
                            <div style="margin-top: 20px;">
                                <p> Setting up two sensors required use of the xshut pin on one of the Sensors. I started out by soldering a wire to a digital pin on the artemis board and the xshut pin on one of the ToF sensors. 
                                    <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab3/sensor2.png" alt="..." /></span>
                                </p>
                                <p> Then in my aduino code, in the setup loop I do the following operations:
                                </p>
                                <p>1. I shutodwn sensor 2 by setting the xshut pin to low.</p>
                                <p>2. I begin sensor 1 and set a new I2C address for sensor 1.</p>
                                <p>3. I bring sensor 2 out of shutdown mode (set to to high).</p>
                                <p>4. I begin sensor 2 and set the I2C address for sensor 2 as default (0x29).
                                </p>
                                <p>Now they are both connected with differnt I2C adresses! </p>
                            </div>
                            <div style="margin-top: 30px;">
                                <p> Now you can see in this video, as I alternate bringing the sensors close to the table they read different values. 
                                    <iframe width="600" height="325" src="https://www.youtube.com/embed/uDRF2Db_COw?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                                </p>
                                <p> To send and recieve data to my computer, I set up a case that activates an if stateemnt in my void loop. So from my python script I call that case then the void loop will continuosly check if data is ready, 
                                    take data, store it in an array, and send it all at once. This is what that method looks like.  
                                    <span class="d-none d-lg-block"><img style="width: 800px; height: auto;" src="images/lab3/slowmethod.png" alt="..." /></span>
                                </p>
                                <p style="margin-top: 30px;"> This method yeilded this graph when I alternated bringing the sensors close to the table.  
                                    <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab3/2tofs.png" alt="..." /></span>
                                </p>
                                <p> Though this graph looks nice, the rate that the data is taken is very slow, this mehtod in the loop where I wait untill the data is ready to take the measurment is taking too long. The loop only runs at less than 8 messages per seond. 
                                    <span class="d-none d-lg-block"><img style="height: 150px; width: auto;" src="images/lab3/slow sample rate.png" alt="..." /></span>
                                </p>
                            </div>
                            <!--------------------------->
                            <div style="margin-top: 40px;" class="subheading mb-3">Quicker method to record data.</div>
                            <div style="margin-top: 20px;">
                                <p> It is essential that the code executes quickly, therefore I cannot let it hang while it waits for the sensor to finish a measurement. This new method allowsd the loop to run, continuously with the only limiting factor 
                                being how quickly each line excecutes and it reads and adds new ToF sensor data from both sensors only when available. Below is how I implemented, see the if statement. </p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab3/fastmethod.png" alt="..." /></span>
                                
                                <p> As you can see the loop runs much faster now! </p>
                                <span class="d-none d-lg-block"><img style="width: 500px; height: auto;" src="images/lab3/fast sampling rate.png" alt="..." /></span>
                                
                                <p style="margin-top: 30px;"> Now I am able to send timestamped messages and graph both sensors data more accuratly. There are spikes becuase the sensor is much slower than the loop, so all the points in betweeen the senssor being ready are zero. 
                                I printed the data and measured the time between each spike as 0.101 seconds. </p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab3/fastgraphs.png" alt="..." /></span>
                            </div>
                            <!------------------- Final priduct -------------------->
                            <div style="margin-top: 20px;">
                                <p> Finally, this is what the completely soldered component looks like!
                                    <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab3/all wired.png" alt="..." /></span>
                                </p>
                            </div>
                            
                        
                        
                        
                        
                        </div>
                    </div>
                </div>
            </section>

<!------------------------------------- Lab 4 ------------------------------------->
<!------------------------------------- Lab 4 ------------------------------------->
<!------------------------------------- Lab 4 ------------------------------------->
        
            <hr class="m-0" />
            <section class="resume-section" id="lab4">
                <div class="resume-section-content">
                    <h2 class="mb-5">Lab 4</h2>

                    
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <!---------------------------INTRO------------------------------->
                            <h3 class="mb-0">Introduction</h3>
                            <div class="subheading mb-3">Lab Objectives</div>
                            <p>The objective of this lab is to set up the two dual motor controllers and spin the wheels! Once we attach those, we can solder all the components together and to the artemis so everything
                            can now sit on the car. I learned how to use a power supply and oscilloscope to verify functionality and I started calibrating the motors to move together with a linear relationship. </p>
                            <div class="subheading mb-3">Components</div>
                            <p>1 x SparkFun RedBoard Artemis Nano</p>
                            <p>1 x USB cable</p>
                            <p>2 x 4m ToF sensor</p>
                            <p>1 x QWIIC Breakout board</p>
                            <p>2 x Qwiic connector</p>
                            <p>1 x JST2 connector+cable</p>
                            <p>1 x Force1 RC car</p>
                            <p>1 x Li-Ion 3.7V 850mAh battery</p>
                            <p>2 x Dual motor drivers</p>
                        </div>
                        <div class="flex-shrink-0"><span class="text-primary">Februrary 21st</span></div>
                    </div>
                        
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <!--------------------------- 1. plan ------------------------------->
                            <h3 class="mb-0">Prelab</h3>
                            <div class="subheading mb-3">Wiring Diagram</div>
                            <div style="margin-top: 20px;">
                                <p> Here is the diagram of how I decided to wire the two motor controlers in parallel and to the artemis. Each motor controller needs two PWM pins becuase they each switch from 
                                forward and backwards using PWM signal. Each board has 2 H bridges but we are only using one so I bridged both A1, B1 together and A2, B2 together. I decided to solder 3 wires together 
                                for the motor controllers and battery to simplify the wiring, it's all grounded and power is deliverd to both boards. We are powering both motor controllers seperatly from the artemis 
                                battery becuase running the motors drains the battery much quicker than the artemis. </p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab4/diagram.png" alt="..." /></span>
                            </div>
                            <div style="margin-top: 20px;">
                                <p> And here is how one of the soldered boards look!</p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab4/mcb.png" alt="..." /></span>
                            </div>
                            
                            <!---------------------------2. soldering ------------------------------->
                            <h3 style="margin-top: 60px;" class="mb-0">Dual Motor Driver Setup</h3>
                            <div class="subheading mb-3">Testing the first motor controller.</div>
                            <div style="margin-top: 20px;">
                                <p> Next I soldered the first motor contorller to the artemis, but connected the Vin and ground wires to the power supply, and the signal out wires to the oscilloscope. Here is 
                                a picture of my setup. And this is the code that I sent the artemis to send a pulse signal to the motor contoller with a delay. I set the power supply to 3.7V as the data sheet suggested.</p>
                                 <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 350px; width: auto;" src="images/lab4/scopesetup.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 300px; width: auto;" src="images/lab4/mcbtest.png" alt="Image 2" /></div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <p> On the oscilloscope, I could change the size of the square wave based on how long the delay was and the size of the signal. This first picture of the oscilloscope display is
                                from the code above, the second picture was me sending two different values. </p>
                                 <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 250px; width: auto;" src="images/lab4/scope.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 250px; width: auto;" src="images/lab4/2diffspeeds.png" alt="Image 2" /></div>
                                </div>
                            </div>
                            <!--------------------------->
                            <div style="margin-top: 70px;" class="subheading mb-3">Strip the car!</div>

                            <div style="margin-top: 20px;">
                                <p> I oppened the car up and cut out the current controller board. </p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab4/stripped car.png" alt="..." /></span>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> The wires that were previously attached to the motor were very loose and I accidently pulled them off, so I just soldered my signal out wires from my controller
                                directly to the motor. </p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab4/batterysolder.png" alt="..." /></span>
                            </div>

                            <!--------------------------->
                            <div style="margin-top: 70px;" class="subheading mb-3">Turn the wheels!</div>

                            <div style="margin-top: 20px;">
                                <p> Next, with the external power supply plugged into the motors, I sent it a signal forwards and backwards by setting a value (between 0 and 255) to one pin and zero to the other, then switching directions by 
                                    alternating which pin I was sending what. As you can see in this video I was very successful going forwards and back for just the first controller!
                                </p>
                                <iframe width="600" height="325" src="https://www.youtube.com/embed/yJLKeyljiKc?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> Then I did the same thing using a 850mAh battery insted of the power supply.</p>
                                <iframe width="600" height="325" src="https://www.youtube.com/embed/ecXs9tZXLcU?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> Final test was to repeat all the steps for the other motor controller. I was very happy to see it was all wired correctly and all four wheels ran as expected!</p>
                                <iframe width="600" height="370" src="https://www.youtube.com/embed/WWETRaUm2M0?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                            </div>

                            <div style="margin-top: 40px;">
                                <p> Here is what my final car looked like all soldered and taped up! I chose to put one ToF sensor on what im calling the "front" and one on the side through the wheels.
                                These locations are not permament but they intuitivly seemed like the most useful locations for obstacle avoidance. I put the IMU on the front on the black box becusue I wanted it to 
                                lay flat and centered through the middle of the car. I put the artemis in the back with the usbc port and the battery port facing outwards becuase I plug and unplug those often. 
                                The reset button is also easy to access. The rest of the wires are tucked into the empty hole, I tried to neatly fold them in but did not want to attach anyhting just incase there was an issue 
                                with my soldering. I closed it over with a piece of duck tape that I can easily remove.   </p>
                                <span class="d-none d-lg-block"><img style="width: 700px; height: auto;" src="images/lab4/labeled car.png" alt="..." /></span>
                            </div>

                            <!--------------------------------- two motor contollers! -------------------------------->
                            <h3 style="margin-top: 60px;" class="mb-0">Testing with wheels on ground</h3>
                            <div class="subheading mb-3">Pros & Cons of each mode</div>

                            <div style="margin-top: 20px;">
                                <p> With the car on the ground, I iterated through different combinations of values until both sides moved at the same speed and the car went straight. The ratio I found for left:right was 185:110.
                                Here is what the basic code looked like while I was essentially guessing and checking. </p>
                                <span class="d-none d-lg-block"><img style="width: 300px; height: auto;" src="images/lab4/manually testing ratios.png" alt="..." /></span>
                                
                                <p style="margin-top: 20px;"> Next, while maintaining this ratio of 185:110, I found the lowest value I could send to move the car. In the video below you can see how it barely moves.</p>
                                <iframe width="600" height="340" src="https://www.youtube.com/embed/_MuioZLNG_8?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe> 
                            </div>

                            <div style="margin-top: 20px;">
                                <p> Now using this information of the ratio between wheels and the range of values I can use, I created a foward and backward drive function with a linear mapping. It maps an input value of 1-100
                                to the coresponding motor values that maintian the ratio. I also put in a  duration paramter so you specify the speed (1-100) and how long you want it to drive for in millisecodns.
                                Here is what my drive forward function looks like!</p>
                                <span class="d-none d-lg-block"><img style="width: 900px; height: auto;" src="images/lab4/drive forward.png" alt="..." /></span>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> Here is a video of it drivng forward where I set the speed to 50 and have it drive for 2.5 seconds! It goes pretty straight but I noticed at the end it turns a bit becuause one of the motors takes
                                longer to slow down. This might be due to the friction inside each motor not being exacly the same. And I could fix this by finding the diffence in time it takes to slow each down and ofset their stop, but for now
                                , I think this driivng straight is sufficient and we will play around more with correcting its trajecetory with PID control.  </p>
                                <iframe width="600" height="340" src="https://www.youtube.com/embed/Jw8T402xqn0?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe> 
                            </div>

                            <!--------------------------- Drive with turns ------------------------------->
                            <h3 style="margin-top: 50px;" class="mb-0">Driving with turns</h3>

                            <div style="margin-top: 30px;">
                                <p> I made a few functions to simplify sending it commands. I made a forward and backward function, and made a turn left 90 and turn rihgt 180, to see how hard it was to tune these values. 
                                It turned out to be much more tedius than I expected and after slighly adjusting the code, uploading and unplugging the robot several times, this process became very repetative and slow. 
                                I did turns in place by spining one side forward and one side backward. Turns were hard to make accurate becuase there was so many variables I could adjust, like difference in speed between the wheels,
                                turning speed, and how long to let it spin for. Overall I found pretty accurate values to send it and the following code is the series of commands I gave it. </p>
                                <span class="d-none d-lg-block"><img style="width: 300px; height: auto;" src="images/lab4/command functions.png" alt="..." /></span>
                            </div>
                            <div style="margin-top: 20px;">
                                <p> Finally, here is the video of it performing these commands. Looks great! Besides the 180 turn that was undershot a bit, I'm happy with the accuracy for just manually adjusting. </p>
                                <iframe width="600" height="340" src="https://www.youtube.com/embed/BHftcGmAwtA?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe> 
                            </div>
                            
                            
                        
                        </div>
                    </div>
                </div>
            </section>

<!------------------------------------- Lab 5 ------------------------------------->
<!------------------------------------- Lab 5 ------------------------------------->
<!------------------------------------- Lab 5 ------------------------------------->
        
            <hr class="m-0" />
            <section class="resume-section" id="lab5">
                <div class="resume-section-content">
                    <h2 class="mb-5">Lab 5</h2>

                    
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <!---------------------------INTRO------------------------------->
                            <h3 class="mb-0">Introduction</h3>
                            <div class="subheading mb-3">Lab Objectives</div>
                            <p>The objective of this lab is to implement closed loop linear control with a PID controller. Since the main loop 
                            (with the controller) runs faster than the ToF sensor can read data, we also need to preform linear extrapolation on the 
                            points where no new sensor data is read. We will only be driving straight towards a wall and stopping at a set distance from 
                            the wall, where the PID controller brings it to this point using sensor feedback. This lab gave me the most trouble, from taking
                            sensor data, to tuning the motors, and finally testing out PID values. But in the end I was able to get my car to succesfully reach 
                            a specified distance efficiently.</p>
                            <div class="subheading mb-3">Components</div>
                            <p>1 x SparkFun RedBoard Artemis Nano</p>
                            <p>1 x USB cable</p>
                            <p>2 x 4m ToF sensor</p>
                            <p>1 x QWIIC Breakout board</p>
                            <p>1 x Li-Ion 3.7V 850mAh battery</p>
                            <p>2 x Dual motor drivers</p>
                        </div>
                        <div class="flex-shrink-0"><span class="text-primary">March 6th</span></div>
                    </div>
                        
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <!--------------------------- 1. pre lab ------------------------------->
                            <h3 class="mb-0">Prelab</h3>
                            <div class="subheading mb-3">Set up of Debugging Method</div>
                            <div style="margin-top: 20px;">
                                <p> In order to debug my system and tune parameters, I was sending an array with all my data after each run. I did this by collecting the data 
                                    in arrays as my control loop runs, and then once the arrays were full, I sent them over as a large string. In my Python script, I have a 
                                    notification handler that handles these strings and stores them in a global array called data. So that when I go to graph it, I can parse 
                                    it by separating commas and graph whatever data I want versus time.
                                </p>
                                <p> The values I found it useful to send over were: the time that the data was taken, the raw TOF sensor readings 
                                    (which gave me -1 if it was not ready), the PWM value I'm inputting into the motors, the unscaled U value calculated from adding P, I, D, 
                                    the errors for the controller, the extrapolated data points combined with the real readings, and controller parameters Kp, Ki, Kd.</p>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> Here are screenshots of how I sent data over Bluetooth from the Arduino code and how I received it in my Python script. In my Arduino, I'm basically 
                                just appending it into one large string. And my notification handler is always running so it is ready to collect data when it is sent over Bluetooth. </p>

                                <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 340px; width: auto;" src="images/lab5/senddata.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 415px; width: auto;" src="images/lab5/getdata.png" alt="Image 2" /></div>
                                </div>
                            </div>
                            
                            <!--------------------------- 2. Debugging ------------------------------->
                            <h3 style="margin-top: 60px;" class="mb-0">Sending Data and Debugging</h3>
                            <h5 style="margin-top: 1px;" class="mb-3">Various Issues I Encountered</h3>
                            
                            <div style="margin-top: 60px;">
                                <div class="subheading mb-4">Sending data too slowly:</div>
                                <p> From my overlaid graphs, I noticed that my data was not sending very frequently and therefore causing the data to be very choppy and the car 
                                    to not be very responsive to the control. I graphed the ToF sensor readings, error, u values, and adjusted speed (see below). The way that I fixed 
                                    this issue was simple, just by not calling sensor.stopRanging() in every loop, only at the end solved this issue.</p>
                                <span class="d-none d-lg-block"><img style="width: 500px; height: auto;" src="images/lab5/sparse data.png" alt="..." /></span>
                                
                                <p> This also kept causing my car to crash into the wall becuase it would not detect it fast enough.</p>
                                <iframe width="600" height="305" src="https://www.youtube.com/embed/C1ORVaEaJxM?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>

                                <p> Once I fixed this, you can see in the graph below I was getting much more frequent readings. I also used the data to calculate how quickly my main 
                                    control loop was running and how frequently my data was being sent. This was easy to calculate since when my ToF is not ready, it sends -1, so I just filtered 
                                    these out and averaged the time in between readings.</p>
                                <p> Frequency of the control loop: <b>113.7 [loops/s]</b><br>
                                  Frequency of ToF data: <b>10.2 [loops/s]</b></p>
                                <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="width: 500px; height: auto;" src="images/lab5/nointerp.png" alt="Image 1" /></div>
                                    <div style="margin-top: 40px; style="margin-left: 8px;"><img style="width: 500px; height: auto;" src="images/lab5/loop time.png" alt="Image 2" /></div>
                                </div>
                            </div>


                            <div style="margin-top: 60px;">
                                <div class="subheading mb-4">Extrapolating wrong:</div>
                                <p> For a lot of the lab, I thought I had extrapolated the data, but in fact, I was interpolating instead! Though the graph looked nice, you can see that it was 
                                jagged (like a staircase) and I was actually interpolating in between data points, and interpolating from both interpolated points and real ToF readings. 
                                Though this was not an issue at the time, it would later lead to issues because I was interpolating from points that were not real. Here is what my nice 
                                (but not correct) interpolated data looked like.</p>
                                <span class="d-none d-lg-block"><img style="width: 500px; height: auto;" src="images/lab5/interpolated.png" alt="..." /></span>

                                <p> Here is what my <b>Extrapolated</b> data looked like after I fixed it. The way it works is once I received at least two data points, 
                                I calculate the slope between them. I only calculate the slope from real sensor values and store it. While the sensor is not ready, I use that same slope 
                                and the time that has passed to extrapolate linearly where it would be next. Here is my new plotted data and my code implementation.</p>
                                 <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 350px; width: auto;" src="images/lab5/fixed extrapolated.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 350px; width: auto;" src="images/lab5/extrapcode.png" alt="Image 2" /></div>
                                </div>

                                <p style="margin-top: 20px;"> Moral of the story: Extrapolation does not equal Interpolation</p>
                            </div>

                            <div style="margin-top: 60px;">
                                <div class="subheading mb-4">Still not driving straight:</div>
                                <p> Even though last week I experimentally found the deadband zone of the motors together and an approximate ratio of speeds between them, once I implemented the PID on this lab, 
                                they were very out of sync. This is because for this lab I set it up so I have a separate function for each wheel which I send the same u. But you can see from this video, 
                                each motor has a very different deadband individually, one would completely stop while the other one is still going, causing it to turn on the ground.</p>
                                <iframe width="600" height="305" src="https://www.youtube.com/embed/gqbAkoinmnM?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                                <p> I had to go back and re-calculate the deadband limits of each wheel, and the PWM ratios between motors for going both forwards and backwards together. Here is my two
                                motor functions for driving straight.</p>
                                <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 250px; width: auto;" src="images/lab5/lefttune.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 250px; width: auto;" src="images/lab5/righttune.png" alt="Image 2" /></div>
                                </div>
                            </div>

                            <div style="margin-top: 60px;">
                                <div class="subheading mb-4">Maping PWM values wrong:</div>
                                <p>The last issue (there were many more) I encountered that I wanted to address was how I was mapping the PWM values wrong but could not tell from my physical driving test. 
                                But I discovered this from my graphs! As you can see in this video, the controller works very well, even though it was driving a bit slowly. I did not see an issue initially 
                                because it was able to stop 300 mm from the wall and correct the overshoot pretty accurately. The issue I was trying to figure out was why it was correcting so slowly and sometimes 
                                it would not correct at all. I think I would get a false "working trial" when it had enough momentum to reach its goal.</p>
                                <iframe width="640" height="310" src="https://www.youtube.com/embed/NoBLHtuZgso?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>

                                <p>By looking at the two graphs below, I realized I was cutting off the lower and higher PWM values but not mapping my U values proportionately in the working range. 
                                So the controller would tell it to move slowly, but that was in my cutoff range so it would not move at all. You can see in this graph the blue and the purple follow each other 
                                until it falls below a certain range.</p>
                                <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 350px; width: auto;" src="images/lab5/corrects v slowly.png" alt="Image 1" /></div>
                                    <div style="margin-top: 50px;" style="margin-left: 8px;"><img style="height: 240px; width: auto;" src="images/lab5/mapwrong.png" alt="Image 2" /></div>
                                </div>
                                
                                <p> I fixed this by mapping the u values so that the lowest u (zero) corresponds to the lowest value in the working range, and a u of 100 would correspond to a PWM of 255. Then I did this for 
                                    negative u values. Here is a graph of what my new mapping looks like. And the car is much faster and alwyas reaches the goal. My code for this mapping is above in my last section. </p>
                                 <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 350px; width: auto;" src="images/lab5/map.png" alt="Image 1" /></div>
                                    <div style="margin-top: 20px;" style="margin-left: 8px;"><img style="height: 240px; width: auto;" src="images/lab5/mapwrong.png" alt="Image 2" /></div>
                                </div>
                            </div>
                            
                            <!--------------------------->
                            <div style="margin-top: 70px;" class="subheading mb-3">PID Implementation</div>

                            <div style="margin-top: 20px;">
                                <p> For the controller, I used PID control. PID stands for proportional, integral and derivitive. This is the formula to calculate the velocity "u" needed to reach a goal. Were
                                error "e" is the differnce between the goal and your current position.</p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab5/PID.png" alt="..." /></span>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> I first started with only just implementing P. I made a function called PID_control that takes in parameters kp, ki, and kd, and I set them all to zero in my code setup. 
                                In my main loop, I collect the current data, then I call the PID function to calculate a value of u. Then this u gets passed into both motor functions. Here is what my PID 
                                function looks like with only P.</p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab5/kp.png" alt="..." /></span>
                            </div>
                            <div style="margin-top: 20px;">
                                <p> I made a function so that I can quickly tune the parameters over Bluetooth, so I can adjust them with an iterative approach to find ideal values. I started with a kp of 1, which made the car 
                                    instantly crash into the wall (good thing we had crash pads). Then, I started slowly decreasing the value until it wouldn't crash into the wall and could quickly correct to the goal. 
                                    I found the value of kp = 0.02 to be ideal for my system because any slower, the car would struggle to move at a reasonable pace, and higher values would make it overshoot too much. 
                                    Here is a video of my car with only the proportional controller. </p>
                                <iframe width="650" height="320" src="https://www.youtube.com/embed/K72eUIcbzMM?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                                <p> When I plot the data, this is what the graphs look like. You can see it overshoots at about 15 cm but then steadies out and has small oscillations around the goal distance. 
                                    The oscillations never went away but there was no steady-state error.</p>
                                <span class="d-none d-lg-block"><img style="width: 900px; height: auto;" src="images/lab5/nod.png" alt="..." /></span>
                            </div>
                            <!--------------------------->
                            <div style="margin-top: 20px;">
                                <p> Next, I added a derivitve term with the constant kd. This is to quickly correct the overshoot. Here is how I implemented it in my controller.</p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab5/kd.png" alt="..." /></span>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> In order to tune kd, I started with 1 and slowly increased kd. This ended up slowing down the car overall, so I increased kp = 0.04, and kept increasing kd until it stopped overshooting. 
                                    I found that increasing it too much made the oscillations too big at the end or made it undershoot. Since the ToF sensor has noise, those small oscillations cause big jumps from the kd term. 
                                    It would be ideal to implement a low pass filter before calculating the derivative term. The value that I ended up choosing was <b>kd = 50</b>. This is a graph of the speed calculated by 
                                    the PID function, the mapped out PWM values, and the error. It appears to be very noisy after adding kd, but the motion of the car doesn't look jittery to me so I am not worried. </p>
                                    <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab5/motor.png" alt="..." /></span>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> What about I? I decided not to implement the integral term because it mostly helps reduce steady state error. Im happy with my controller and tested it with various 
                                    incoming speeds and there were no issues. Adding ki could also increase overshoot so I chose to leave it.</p>
                            </div>

                            <!--------------------------->
                            <h3 style="margin-top: 60px;" class="mb-0">Final linear controller</h3>
                            <div style="margin-top: 70px;" class="subheading mb-3">A few trials to prove that the controller works!</div>

                            <div style="margin-top: 20px;">
                                <p> 1. This first trial is from the <b>furthest distance (1.5 m)</b>, the target distance was 300 mm from the wall. </p>
                                <p> <b> kp = 0.04, kd = 50</b> </p>
                                <iframe width="650" height="325" src="https://www.youtube.com/embed/sDxzzf49MZc?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                                <span class="d-none d-lg-block"><img style="width: 950px; height: auto;" src="images/lab5/long.png" alt="..." /></span>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> 2. This second trial is from a <b>middle distance (1.1 m)</b>, the target distance was 300 mm from the wall. </p>
                                <p> <b> kp = 0.04, kd = 50</b> </p>
                                <iframe width="650" height="325" src="https://www.youtube.com/embed/r_l4wXSvBTw?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                                <span class="d-none d-lg-block"><img style="width: 950px; height: auto;" src="images/lab5/medium.png" alt="..." /></span>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> 3. This third trial is from a <b>short distance (0.6 m)</b>, the target distance was 300 mm from the wall. </p>
                                <p> <b> kp = 0.04, kd = 50</b> </p>
                                <iframe width="650" height="325" src="https://www.youtube.com/embed/d95cVfNwhMU?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                                <span class="d-none d-lg-block"><img style="width: 950px; height: auto;" src="images/lab5/short.png" alt="..." /></span>
                            </div>

                            
                            <!--------------------------------- Final discussion -------------------------------->
                            
                            <div style="margin-top: 40px;">
                                <p> Overall, I am very happy with my controller performance. In all trials, it made it to the target distance and did not overshoot. You can see on the left graphs
                                the controllers working agaisnt eachotehr to keep the car steady. My next steps could be to add a function to stop the car once it is within 2 percent error so it
                                does not keep shaking back and forth.</p>
                            </div>   
                        
                        </div>
                    </div>
                </div>
            </section>

<!------------------------------------- Lab 6 ------------------------------------->
<!------------------------------------- Lab 6 ------------------------------------->
<!------------------------------------- Lab 6 ------------------------------------->
        
            <hr class="m-0" />
            <section class="resume-section" id="lab6">
                <div class="resume-section-content">
                    <h2 class="mb-5">Lab 6</h2>

                    
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <!---------------------------INTRO------------------------------->
                            <h3 class="mb-0">Introduction</h3>
                            <div class="subheading mb-3">Lab Objectives</div>
                            <p>The objective of this lab is to set up the two dual motor controllers and spin the wheels! Once we attach those, we can solder all the components together and to the artemis so everything
                            can now sit on the car. I learned how to use a power supply and oscilloscope to verify functionality and I started calibrating the motors to move together with a linear relationship. </p>
                            <div class="subheading mb-3">Components</div>
                            <p>1 x SparkFun RedBoard Artemis Nano</p>
                            <p>1 x USB cable</p>
                            <p>2 x 4m ToF sensor</p>
                            <p>1 x QWIIC Breakout board</p>
                            <p>2 x Qwiic connector</p>
                            <p>1 x JST2 connector+cable</p>
                            <p>1 x Force1 RC car</p>
                            <p>1 x Li-Ion 3.7V 850mAh battery</p>
                            <p>2 x Dual motor drivers</p>
                        </div>
                        <div class="flex-shrink-0"><span class="text-primary">March 13th</span></div>
                    </div>
                        
                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <!--------------------------- 1. plan ------------------------------->
                            <h3 class="mb-0">Prelab</h3>
                            <div class="subheading mb-3">Wiring Diagram</div>
                            <div style="margin-top: 20px;">
                                <p> Here is the diagram of how I decided to wire the two motor controlers in parallel and to the artemis. Each motor controller needs two PWM pins becuase they each switch from 
                                forward and backwards using PWM signal. Each board has 2 H bridges but we are only using one so I bridged both A1, B1 together and A2, B2 together. I decided to solder 3 wires together 
                                for the motor controllers and battery to simplify the wiring, it's all grounded and power is deliverd to both boards. We are powering both motor controllers seperatly from the artemis 
                                battery becuase running the motors drains the battery much quicker than the artemis. </p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab4/diagram.png" alt="..." /></span>
                            </div>
                            <div style="margin-top: 20px;">
                                <p> And here is how one of the soldered boards look!</p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab4/mcb.png" alt="..." /></span>
                            </div>
                            
                            <!---------------------------2. soldering ------------------------------->
                            <h3 style="margin-top: 60px;" class="mb-0">Dual Motor Driver Setup</h3>
                            <div class="subheading mb-3">Testing the first motor controller.</div>
                            <div style="margin-top: 20px;">
                                <p> Next I soldered the first motor contorller to the artemis, but connected the Vin and ground wires to the power supply, and the signal out wires to the oscilloscope. Here is 
                                a picture of my setup. And this is the code that I sent the artemis to send a pulse signal to the motor contoller with a delay. I set the power supply to 3.7V as the data sheet suggested.</p>
                                 <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 350px; width: auto;" src="images/lab4/scopesetup.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 300px; width: auto;" src="images/lab4/mcbtest.png" alt="Image 2" /></div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <p> On the oscilloscope, I could change the size of the square wave based on how long the delay was and the size of the signal. This first picture of the oscilloscope display is
                                from the code above, the second picture was me sending two different values. </p>
                                 <div style="display: flex; align-items: flex-start;">
                                    <div style="margin-right: 8px;"><img style="height: 250px; width: auto;" src="images/lab4/scope.png" alt="Image 1" /></div>
                                    <div style="margin-left: 8px;"><img style="height: 250px; width: auto;" src="images/lab4/2diffspeeds.png" alt="Image 2" /></div>
                                </div>
                            </div>
                            <!--------------------------->
                            <div style="margin-top: 70px;" class="subheading mb-3">Strip the car!</div>

                            <div style="margin-top: 20px;">
                                <p> I oppened the car up and cut out the current controller board. </p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab4/stripped car.png" alt="..." /></span>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> The wires that were previously attached to the motor were very loose and I accidently pulled them off, so I just soldered my signal out wires from my controller
                                directly to the motor. </p>
                                <span class="d-none d-lg-block"><img style="width: 600px; height: auto;" src="images/lab4/batterysolder.png" alt="..." /></span>
                            </div>

                            <!--------------------------->
                            <div style="margin-top: 70px;" class="subheading mb-3">Turn the wheels!</div>

                            <div style="margin-top: 20px;">
                                <p> Next, with the external power supply plugged into the motors, I sent it a signal forwards and backwards by setting a value (between 0 and 255) to one pin and zero to the other, then switching directions by 
                                    alternating which pin I was sending what. As you can see in this video I was very successful going forwards and back for just the first controller!
                                </p>
                                <iframe width="600" height="325" src="https://www.youtube.com/embed/yJLKeyljiKc?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> Then I did the same thing using a 850mAh battery insted of the power supply.</p>
                                <iframe width="600" height="325" src="https://www.youtube.com/embed/ecXs9tZXLcU?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> Final test was to repeat all the steps for the other motor controller. I was very happy to see it was all wired correctly and all four wheels ran as expected!</p>
                                <iframe width="600" height="370" src="https://www.youtube.com/embed/WWETRaUm2M0?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe>
                            </div>

                            <div style="margin-top: 40px;">
                                <p> Here is what my final car looked like all soldered and taped up! I chose to put one ToF sensor on what im calling the "front" and one on the side through the wheels.
                                These locations are not permament but they intuitivly seemed like the most useful locations for obstacle avoidance. I put the IMU on the front on the black box becusue I wanted it to 
                                lay flat and centered through the middle of the car. I put the artemis in the back with the usbc port and the battery port facing outwards becuase I plug and unplug those often. 
                                The reset button is also easy to access. The rest of the wires are tucked into the empty hole, I tried to neatly fold them in but did not want to attach anyhting just incase there was an issue 
                                with my soldering. I closed it over with a piece of duck tape that I can easily remove.   </p>
                                <span class="d-none d-lg-block"><img style="width: 700px; height: auto;" src="images/lab4/labeled car.png" alt="..." /></span>
                            </div>

                            <!--------------------------------- two motor contollers! -------------------------------->
                            <h3 style="margin-top: 60px;" class="mb-0">Testing with wheels on ground</h3>
                            <div class="subheading mb-3">Pros & Cons of each mode</div>

                            <div style="margin-top: 20px;">
                                <p> With the car on the ground, I iterated through different combinations of values until both sides moved at the same speed and the car went straight. The ratio I found for left:right was 185:110.
                                Here is what the basic code looked like while I was essentially guessing and checking. </p>
                                <span class="d-none d-lg-block"><img style="width: 300px; height: auto;" src="images/lab4/manually testing ratios.png" alt="..." /></span>
                                
                                <p style="margin-top: 20px;"> Next, while maintaining this ratio of 185:110, I found the lowest value I could send to move the car. In the video below you can see how it barely moves.</p>
                                <iframe width="600" height="340" src="https://www.youtube.com/embed/_MuioZLNG_8?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe> 
                            </div>

                            <div style="margin-top: 20px;">
                                <p> Now using this information of the ratio between wheels and the range of values I can use, I created a foward and backward drive function with a linear mapping. It maps an input value of 1-100
                                to the coresponding motor values that maintian the ratio. I also put in a  duration paramter so you specify the speed (1-100) and how long you want it to drive for in millisecodns.
                                Here is what my drive forward function looks like!</p>
                                <span class="d-none d-lg-block"><img style="width: 900px; height: auto;" src="images/lab4/drive forward.png" alt="..." /></span>
                            </div>

                            <div style="margin-top: 20px;">
                                <p> Here is a video of it drivng forward where I set the speed to 50 and have it drive for 2.5 seconds! It goes pretty straight but I noticed at the end it turns a bit becuause one of the motors takes
                                longer to slow down. This might be due to the friction inside each motor not being exacly the same. And I could fix this by finding the diffence in time it takes to slow each down and ofset their stop, but for now
                                , I think this driivng straight is sufficient and we will play around more with correcting its trajecetory with PID control.  </p>
                                <iframe width="600" height="340" src="https://www.youtube.com/embed/Jw8T402xqn0?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe> 
                            </div>

                            <!--------------------------- Drive with turns ------------------------------->
                            <h3 style="margin-top: 50px;" class="mb-0">Driving with turns</h3>

                            <div style="margin-top: 30px;">
                                <p> I made a few functions to simplify sending it commands. I made a forward and backward function, and made a turn left 90 and turn rihgt 180, to see how hard it was to tune these values. 
                                It turned out to be much more tedius than I expected and after slighly adjusting the code, uploading and unplugging the robot several times, this process became very repetative and slow. 
                                I did turns in place by spining one side forward and one side backward. Turns were hard to make accurate becuase there was so many variables I could adjust, like difference in speed between the wheels,
                                turning speed, and how long to let it spin for. Overall I found pretty accurate values to send it and the following code is the series of commands I gave it. </p>
                                <span class="d-none d-lg-block"><img style="width: 300px; height: auto;" src="images/lab4/command functions.png" alt="..." /></span>
                            </div>
                            <div style="margin-top: 20px;">
                                <p> Finally, here is the video of it performing these commands. Looks great! Besides the 180 turn that was undershot a bit, I'm happy with the accuracy for just manually adjusting. </p>
                                <iframe width="600" height="340" src="https://www.youtube.com/embed/BHftcGmAwtA?rel=0&modestbranding=1&showinfo=0" frameborder="0" allowfullscreen></iframe> 
                            </div>
                            
                            
                        
                        </div>
                    </div>
                </div>
            </section>


        </div>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>
